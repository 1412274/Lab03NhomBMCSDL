/*----------------------------------------------------------
MASV:1412053-1412430-1412544
HO TEN CAC THANH VIEN NHOM:
	1412053	Nguyễn Huyền Quý Châu
	1412430 Nguyễn Vũ Quang
	1412544	Phạm Đức Tiên
LAB: 04 - NHOM
NGAY:31-05-2017
----------------------------------------------------------*/
use QLSVNhom
go

/* CAU LENH TAO STORED PROCEDURE */
/*cau c-i*/ 

CREATE proc SP_INS_PUBLIC_ENCRYPT_NHANVIEN
	@MANV VARCHAR(20),
	@HOTEN NVARCHAR(100),
	@EMAIL VARCHAR(20),
	@LUONG VARBINARY(MAX),
	@TENDN NVARCHAR(100),
	@MK VARBINARY(MAX),
	@PUB VARCHAR(MAX)
	AS
	BEGIN
	INSERT INTO NHANVIEN(MANV, HOTEN, EMAIL,LUONG,TENDN,MATKHAU,PUBKEY) 
		VALUES ( @MANV, @HOTEN, @EMAIL,@LUONG,@TENDN,@MK,@PUB);
	END
GO

/*cau c-ii*/
CREATE proc SP_SEL_PUBLIC_ENCRYPT_NHANVIEN
	@TENDN NVARCHAR(100),
	@MK VARBINARY(MAX)
	as
	SELECT MANV, 
		HOTEN, 
		EMAIL,
		LUONG
	FROM dbo.NHANVIEN as NV
	WHERE NV.TENDN=@TENDN AND NV.MATKHAU=@MK
go

/*tao proc cho SINHVIEN*/
CREATE proc SP_INS_PUBLIC_ENCRYPT_SINHVIEN
	@MASV NVARCHAR(20),
	@HOTEN nVARCHAR(100),
	@NGAYSINH DATETIME,
	@DIACHI NVARCHAR(200),
	@MALOP VARCHAR(20),
	@TENDN NVARCHAR(100),
	@MATKHAU VARBINARY(MAX)
	AS
	BEGIN
	INSERT INTO SINHVIEN(MASV, HOTEN, NGAYSINH,DIACHI,MALOP,TENDN,MATKHAU) 
		VALUES ( @MASV, @HOTEN, @NGAYSINH,@DIACHI,@MALOP,@TENDN,@MATKHAU)
	END
go

CREATE proc SP_UPDATE_PUBLIC_ENCRYPT_SINHVIEN
	@MASV NVARCHAR(20),
	@HOTEN nVARCHAR(100),
	@NGAYSINH DATETIME,
	@DIACHI NVARCHAR(200),
	@MALOP VARCHAR(20),
	@TENDN NVARCHAR(100),
	@MATKHAU VARBINARY(MAX)
	AS
	BEGIN
	UPDATE SINHVIEN
	SET HOTEN=@HOTEN, NGAYSINH=@NGAYSINH,DIACHI=@DIACHI,MALOP=@MALOP,TENDN=@TENDN,MATKHAU=@MATKHAU
	WHERE  MASV=@MASV
	END
go

/*Tao cho NHANVIEN*/
CREATE proc SP_UPDATE_PUBLIC_ENCRYPT_NHANVIEN
	@MANV VARCHAR(20),
	@HOTEN NVARCHAR(100),
	@EMAIL VARCHAR(20),
	@LUONG VARBINARY(MAX),
	@TENDN NVARCHAR(100),
	@MK VARBINARY(MAX),
	@PUB VARCHAR(20)
	AS
	BEGIN
	UPDATE NHANVIEN
	SET HOTEN=@HOTEN,EMAIL=@EMAIL,LUONG=@LUONG,TENDN=@TENDN,MATKHAU=@MK,PUBKEY=@PUB
	WHERE  MANV=@MANV
	END
go


/*cau d*/
EXEC SP_INS_PUBLIC_ENCRYPT_NHANVIEN 'NV01', 'Nguyen Van A', 'nva@', 0x0E5CE8312DEC82CB17BA241C20A9DBD947C35CF3E546693CC6408F52361E58E40E19C21F0A2EFFF7F08A8CD4847CFEF656A058BC05B48E7D89AD4C722EC7C8C8,'nva', 0x7C4A8D09CA3762AF61E59520943DC26494F8941B, NTEyITxSU0FLZXlWYWx1ZT48TW9kdWx1cz52bW50VXp6bDhtVlBITU1MeGNqT3p0bDRVRlVrYnRhWXFoSVAwVnNLNWhpdFkvcTNmUGMrTjhZL25VQlhVS3k5TDBSa0FMVVpyTG1qTHRFM1kxNjcyUT09PC9Nb2R1bHVzPjxFeHBvbmVudD5BUUFCPC9FeHBvbmVudD48L1JTQUtleVZhbHVlPg==

EXEC SP_SEL_PUBLIC_ENCRYPT_NHANVIEN 'NVA', 0x7C4A8D09CA3762AF61E59520943DC26494F8941B